<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1'/>
  <title>Hostile Developer - Working with Templates in Ruby ERB</title>
  <link href="/stylesheets/application.css" rel="stylesheet" type="text/css" />
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />

</head>
<body>
<div id="container">
  <section id="header">
  <header>
<a href="/">        <h1 class="brand"><span class="hostile">Hostile</span> Developer</h1>

        <h3 class="tag-line">I am Steven. Hear me Rant.</h3>
</a>  </header>

  <section class='social'>
    <a target="_blank" href="http://twitter.com/_StevenNunez/"><i class="fa fa-twitter"></i></a>
    <a target="_blank" href="https://github.com/StevenNunez/"><i class="fa fa-github"></i></a>
  </section>
  <nav>
    <ul class='links'>
      <li><a href="/">Home</a></li>
      <li><a href="/blog.html">Blog</a></li>
    </ul>
  </nav>
</section>


  <main id='articles' role="main">
    <h1 class="article-title"><a href="/2015/05/28/working-with-templates-in-ruby-erb.html">Working with Templates in Ruby ERB</a></h1>
    <h1>Templates in ERB</h1>

<p>This post is a bit of a thought experiment. Looking into this led me down the route of some interesting ruby solutions.</p>

<h2>The problem</h2>

<p>Ruby ships with the <code>erb</code> library, but it natively doesn&rsquo;t come with a way to wrap one ERB file in another. This makes composing files difficult. There&rsquo;s no way to use something like rails&rsquo; <code>yield</code> method.</p>

<h3>Some Basic ERB</h3>

<p>Here&rsquo;s how we&rsquo;d render a simple erb template.</p>
<div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="nb">require</span> <span class="s1">'erb'</span>
<span class="n">template</span> <span class="o">=</span> <span class="s2">"1 and 1 is &lt;%= 1 + 1 %&gt;"</span>
<span class="no">ERB</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">template</span><span class="p">).</span><span class="nf">result</span>
</pre></td></tr></tbody></table>
</div>

<p>This returns the interpreted string. If we try to use the <code>yield</code> keyword, we&rsquo;ll run into a bit of a problem.</p>
<div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="nb">require</span> <span class="s1">'erb'</span>
<span class="n">template</span> <span class="o">=</span> <span class="s2">"&lt;%= yield %&gt;"</span>
<span class="no">ERB</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">template</span><span class="p">).</span><span class="nf">result</span> <span class="c1">#=&gt; LocalJumpError: no block given (yield)</span>
</pre></td></tr></tbody></table>
</div>

<p>Eek! No bueno. You might be thinking, &ldquo;Well, you have to give a block to&hellip; something&rdquo;. Good guess, but wrong.</p>
<div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="nb">require</span> <span class="s1">'erb'</span>
<span class="n">template</span> <span class="o">=</span> <span class="s2">"&lt;%= yield %&gt;"</span>
<span class="no">ERB</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">template</span><span class="p">).</span><span class="nf">result</span> <span class="k">do</span>
  <span class="s2">"HERE"</span>
<span class="k">end</span>
<span class="c1"># or</span>
<span class="no">ERB</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">template</span><span class="p">)</span> <span class="k">do</span>
  <span class="s2">"HERE"</span>
<span class="k">end</span><span class="p">.</span><span class="nf">result</span>
</pre></td></tr></tbody></table>
</div>

<p>All sorts of crazy happens.</p>

<h3>Defining a Renderer</h3>

<p>ERB does come with a curious set of methods that let you add the current context of the ERB instance (stuff like the template, variables, all that stuff), to another object.</p>

<p>That looks like this:</p>
<div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre><span class="nb">require</span> <span class="s1">'erb'</span>
<span class="c1"># create a container for our new method</span>
<span class="k">class</span> <span class="nc">LayoutRenderer</span>
<span class="k">end</span>

<span class="c1"># load the erb instance</span>
<span class="n">template</span> <span class="o">=</span> <span class="s2">"Before &lt;%= yield %&gt; After"</span>
<span class="n">erb</span> <span class="o">=</span> <span class="no">ERB</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>

<span class="c1"># create method on LayoutRenderer. We'll pass a block to THIS method</span>
<span class="n">erb</span><span class="p">.</span><span class="nf">def_method</span><span class="p">(</span><span class="no">LayoutRenderer</span><span class="p">,</span> <span class="s1">'render'</span><span class="p">)</span>

<span class="c1"># Then call our LayoutRenderer</span>
<span class="n">result</span> <span class="o">=</span> <span class="no">LayoutRenderer</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">render</span> <span class="k">do</span>
  <span class="s2">"I'm somewhere in the middle"</span>
<span class="k">end</span>
<span class="n">result</span> <span class="c1"># =&gt; "Before I'm somewhere in the middle After"</span>
</pre></td></tr></tbody></table>
</div>

<p>Cool! Now it&rsquo;s a matter of rendering another template inside of it. We&rsquo;ll need a few files:</p>

<p>A layout:</p>
<div class="highlight html"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre>  <span class="cp">&lt;!DOCTYPE html&gt;</span>
  <span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Document<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Layout<span class="nt">&lt;/h1&gt;</span>
    <span class="err">&lt;</span>%= yield %&gt;
  <span class="nt">&lt;/body&gt;</span>
  <span class="nt">&lt;/html&gt;</span>
</pre></td></tr></tbody></table>
</div>

<p>An index file:</p>
<div class="highlight html"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="nt">&lt;p&gt;</span>
  I'm in a template
<span class="nt">&lt;/p&gt;</span>
</pre></td></tr></tbody></table>
</div>

<p>And our renderer code:</p>
<div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre></td><td class="code"><pre><span class="nb">require</span> <span class="s1">'erb'</span>

<span class="k">class</span> <span class="nc">LayoutRenderer</span>
<span class="k">end</span>

<span class="n">layout_template</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s1">'layout.html.erb'</span><span class="p">)</span>
<span class="n">inner_template</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s1">'index.html.erb'</span><span class="p">)</span>

<span class="n">layout</span> <span class="o">=</span> <span class="no">ERB</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">layout_template</span><span class="p">)</span>
<span class="n">inner</span> <span class="o">=</span> <span class="no">ERB</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">inner_template</span><span class="p">)</span>

<span class="n">layout</span><span class="p">.</span><span class="nf">def_method</span><span class="p">(</span><span class="no">LayoutRenderer</span><span class="p">,</span> <span class="s1">'render'</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="no">LayoutRenderer</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">render</span> <span class="k">do</span>
  <span class="n">inner</span><span class="p">.</span><span class="nf">result</span> <span class="c1"># call the regular erb #result method</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="n">result</span>
</pre></td></tr></tbody></table>
</div>

<p>NOTE: If you&rsquo;re playing with this and try to <code>puts</code> this line&hellip;</p>
<div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="nb">puts</span> <span class="no">LayoutRenderer</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">render</span> <span class="k">do</span>
  <span class="n">inner</span><span class="p">.</span><span class="nf">result</span>
<span class="k">end</span>
</pre></td></tr></tbody></table>
</div>

<p>&hellip; you&rsquo;ll get some weird issue. I think it&rsquo;s trying to finish the render before loading the block.</p>

<h2>Final Thoughts</h2>

<p>This was fun to play with. Until next time, Happy Clacking.</p>

    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'hostiledeveloper'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  </main>

  <aside id="history">
    <section class="recent">
      <h2>Recent Articles</h2>
      <ol class="articles">
            <li><a href="/2015/08/21/lets-learn-about-rack.html">Let's learn about Rack</a>
            <li><a href="/2015/06/08/rails-foreign-key-constraints-the-ugly-way.html">Rails Foreign Key Constraints - The Ugly Way</a>
            <li><a href="/2015/05/28/working-with-templates-in-ruby-erb.html">Working with Templates in Ruby ERB</a>
            <li><a href="/2015/05/20/elixir-tuples-vs-lists.html">Elixir - Tuples vs Lists</a>
            <li><a href="/2015/02/22/let-me-find-out.html">Let me find out</a>
            <li><a href="/2014/11/25/next-generation-is-better-i-promise.html">Next generation is better. I promise</a>
            <li><a href="/2014/05/18/using-ruby-to-learn-javascript.html">Using Ruby to learn JavaScript</a>
            <li><a href="/2014/04/26/on-why-learning-to-program-is-hard.html">On why learning to program is hard</a>
            <li><a href="/2014/04/13/closures.html">Closures</a>
            <li><a href="/2014/02/15/custom-params-in-route-resources.html">Custom params in route resources</a>
      </ol>
    </section>

    <section class="tags">
      <h2>Tags</h2>
      <ol>
            <li><a href="/tags/basics.html">basics</a> (1)</a></li>
            <li><a href="/tags/beginner.html">beginner</a> (1)</a></li>
            <li><a href="/tags/closures.html">closures</a> (1)</a></li>
            <li><a href="/tags/components-of-programming.html">components of programming</a> (1)</a></li>
            <li><a href="/tags/elixir.html">elixir</a> (1)</a></li>
            <li><a href="/tags/enumerable.html">enumerable</a> (1)</a></li>
            <li><a href="/tags/find.html">find</a> (1)</a></li>
            <li><a href="/tags/fundamentals.html">fundamentals</a> (1)</a></li>
            <li><a href="/tags/generators.html">generators</a> (1)</a></li>
            <li><a href="/tags/javascript.html">javascript</a> (3)</a></li>
            <li><a href="/tags/learning.html">learning</a> (1)</a></li>
            <li><a href="/tags/navigation.html">navigation</a> (1)</a></li>
            <li><a href="/tags/polyglot.html">polyglot</a> (1)</a></li>
            <li><a href="/tags/postgresql.html">postgresql</a> (1)</a></li>
            <li><a href="/tags/promises.html">promises</a> (1)</a></li>
            <li><a href="/tags/rack.html">rack</a> (1)</a></li>
            <li><a href="/tags/rails.html">rails</a> (2)</a></li>
            <li><a href="/tags/routing.html">routing</a> (1)</a></li>
            <li><a href="/tags/ruby.html">ruby</a> (5)</a></li>
            <li><a href="/tags/sharp-axe.html">sharp axe</a> (1)</a></li>
            <li><a href="/tags/web.html">web</a> (1)</a></li>
      </ol>
    </section>
    <section class="by-month">
      <h2>By Month</h2>
      <ol>
            <li><a href="/2015/08.html">August 2015</a>
              (1)</a></li>
            <li><a href="/2015/06.html">June 2015</a>
              (1)</a></li>
            <li><a href="/2015/05.html">May 2015</a>
              (2)</a></li>
            <li><a href="/2015/02.html">February 2015</a>
              (1)</a></li>
            <li><a href="/2014/11.html">November 2014</a>
              (1)</a></li>
            <li><a href="/2014/05.html">May 2014</a>
              (1)</a></li>
            <li><a href="/2014/04.html">April 2014</a>
              (2)</a></li>
            <li><a href="/2014/02.html">February 2014</a>
              (1)</a></li>
            <li><a href="/2013/10.html">October 2013</a>
              (1)</a></li>
      </ol>
    </section>
  </aside>
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48123503-1', 'auto');
  ga('send', 'pageview');

</script>

</div>
</body>
</html>
