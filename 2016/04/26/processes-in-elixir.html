<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1'/>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Hostile Developer - Processes in Elixir</title>
  <link href="/favicon.ico" rel="icon" type="image/ico" />
  <link href="/stylesheets/application.css" rel="stylesheet" type="text/css" />
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    document.addEventListener("DOMContentLoaded", function(event) {
      mermaid.initialize({startOnLoad:true});
    });
  </script>
<div id="container">
  <section id="header">
  <header>
<a href="/">        <h1 class="brand"><span class="hostile">Hostile</span> Developer</h1>
        <h4 class="tag-line">I am Steven. Hear me Rant.</h4>
</a>  </header>

  <section class='social'>
    <a href="http://twitter.com/_StevenNunez/" target="_blank"><i class="fa fa-twitter"></i></a>
    <a href="https://github.com/StevenNunez/" target="_blank"><i class="fa fa-github"></i></a>
  </section>
</section>


  <main id='article' role="main">
    <h1 class="article-title"><a href="/2016/04/26/processes-in-elixir.html">Processes in Elixir</a></h1>
    <blockquote>
<p>The unit of concurrency in Elixir is a process. A process is  capable of responding to messages, and maintaining state. The only way to interact with a process is to send it a message.</p>

<p><strong>Steven Nunez (Hostile Developer)</strong></p>
</blockquote>

<h2>Creating a process</h2>

<p>We&rsquo;ll be climbing the ladder of abstraction but let&rsquo;s start at the bottom.</p>

<p><img alt="getinsertpic.com" src="http://media0.giphy.com/media/byvw3EmW6L37q/200.gif" /></p>

<p>We use the <code>spawn</code> function to create a new process. We pass it a function and that code will run in an isolated process.</p>
<div class="highlight"><pre class="highlight elixir"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="n">pid</span> <span class="o">=</span> <span class="n">spawn</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span>
  <span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="s2">"I run in a different process)"</span><span class="p">)</span>
  <span class="no">IO</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
<span class="k">end</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div>
<p>This code will print its process id. Don&rsquo;t be fooled! It&rsquo;s running in a separate process, but <code>IO.puts</code> is set to print output to the <code>group_leader</code>. That&rsquo;s your main console by default.</p>

<p>Try checking if this process is alive and you&rsquo;ll be met with sad news:
<code>elixir
Process.alive?(pid) # =&gt; false
</code>
Once a process&rsquo; is done with it&rsquo;s job&hellip; it dies. Cruel world.
<img alt="getinsertpic.com" src="http://media3.giphy.com/media/XrT2XN8L6yoMg/200.gif" /></p>

<p>To interact with the process, we have to teach a process how to receive a message.
<code>elixir
pid = spawn(fn -&gt;
  receive do
    {:help} -&gt; IO.puts &quot;Helping!&quot;
  end
end)
Process.alive?(pid) # =&gt; true
</code></p>

<p>Doing this will keep the process alive. We can send this process a message to trigger the corresponding code.</p>
<div class="highlight"><pre class="highlight elixir"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">send</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="p">{</span><span class="ss">:help</span><span class="p">})</span> <span class="c1"># prints Helping!</span>
<span class="no">Process</span><span class="o">.</span><span class="n">alive?</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
</pre></td></tr></tbody></table></code></pre></div>
<h3>send and receive</h3>

<p><code>send</code> is how we send messages to a process. We can send ANY message to a process, and it&rsquo;s up to the process to respond to the message. You define which messages you respond to with a <code>receive</code> block and a list of messages you can respond to.</p>

<p>One consideration here: <em>If you don&rsquo;t give your process a way to respond to a message, it will keep  it unprocessed. This could lead to memory issues by filling your MAILBOX (real term, look it up)</em></p>

<p>Pretty easy to solve for this. Modify our last <code>receive</code> block to look like this:</p>
<div class="highlight"><pre class="highlight elixir"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="n">pid</span> <span class="o">=</span> <span class="n">spawn</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span>
  <span class="k">receive</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:help</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="s2">"Helping!"</span>
    <span class="n">_</span> <span class="o">-&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="s2">"Don't know what to do with that"</span>
  <span class="k">end</span>
<span class="k">end</span><span class="p">)</span>
<span class="n">send</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="ss">:beef</span><span class="p">)</span> <span class="c1"># prints "Don't know what to do with that"</span>
</pre></td></tr></tbody></table></code></pre></div>
<p>Once something matches code in the <code>receive</code> block, the block exits. If that&rsquo;s the last thing in the process, the process dies. We&rsquo;ll need to define a loop to create an immortal process.</p>

<h2>loops with recursion</h2>

<p>For this next part, we&rsquo;ll define a module with a loop function.
<code>elixir
defmodule Help do
  def loop do
    receive do
      {:help} -&gt; IO.puts &quot;Helping!&quot;
      _ -&gt; IO.puts &quot;Don&#39;t know what to do with that&quot;
    end
    loop # &lt;------ Super important!
  end
end
</code></p>

<p>Then we&rsquo;ll run this function in a process using <code>MFA</code> notation.
<code>elixir
pid = spawn(Help, :loop, [])
send(pid, {:help}) # prints &quot;Helping!&quot;
send(pid, {:beef}) # prints &quot;Don&#39;t know what to do with that&quot;
send(pid, {:help}) # prints &quot;Helping!&quot;
</code></p>

<p>What&rsquo;s going on? First off, in our <code>loop</code> function, we&rsquo;re doing the same <code>receive</code> block, preventing our process from moving forward. Once something matches, we call <code>loop</code> again, locking us in a receive block again.</p>

<p>When working with modules, you can spawn processes in a couple of ways. We used <code>MFA</code> which stands for Module/Function/Arguments, but we could have done it this way.</p>
<div class="highlight"><pre class="highlight elixir"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">spawn</span><span class="p">(</span><span class="o">&amp;</span><span class="no">Help</span><span class="o">.</span><span class="k">loop</span><span class="o">/</span><span class="mi">0</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div>
<p>Both work fine.</p>

<h2>Return to sender</h2>

<p>Until now, we&rsquo;ve been printing our result to the screen, but that&rsquo;s returning a value to <strong>you</strong> dear reader, not your process. To do that, we&rsquo;ll need to have our <code>loop</code> function send a message instead of printing. For THAT to work, we&rsquo;ll need to include the sender in the message we send. Referencing the current process is easy: use <code>self</code>.</p>
<div class="highlight"><pre class="highlight elixir"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="k">defmodule</span> <span class="no">Help</span> <span class="k">do</span>
  <span class="k">def</span> <span class="k">loop</span> <span class="k">do</span>
    <span class="k">receive</span> <span class="k">do</span>
      <span class="p">{</span><span class="ss">:help</span><span class="p">,</span> <span class="n">help_seeker</span><span class="p">}</span> <span class="o">-&gt;</span>
        <span class="n">send</span><span class="p">(</span><span class="n">help_seeker</span><span class="p">,</span> <span class="p">{</span><span class="ss">:reponse</span><span class="p">,</span> <span class="s2">"Helping!"</span><span class="p">})</span>
      <span class="n">_</span> <span class="o">-&gt;</span>
        <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="s2">"Don't know what to do with that"</span>
    <span class="k">end</span>
    <span class="k">loop</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">helper</span> <span class="o">=</span> <span class="n">spawn</span><span class="p">(</span><span class="no">Help</span><span class="p">,</span> <span class="ss">:loop</span><span class="p">,</span> <span class="p">[])</span>
<span class="n">send</span><span class="p">(</span><span class="n">helper</span><span class="p">,</span> <span class="p">{</span><span class="ss">:help</span><span class="p">,</span> <span class="n">self</span><span class="p">})</span>
<span class="c1"># There's a message in my mailbox!!!!</span>
<span class="n">flush</span>
</pre></td></tr></tbody></table></code></pre></div>
<p>Wall of code! We updated our <code>receive</code> to match on the tuple <code>{:help, help_seeker}</code>. We later send this process a message, passing the console process (yes, it&rsquo;s a process too!) as the one seeking help. We finish up by calling <code>flush</code> to show our messages in the console.</p>

<h1>Wrap up</h1>

<p>We&rsquo;ve seen 2 patterns for processes. Tasks where you care about the return value, and others where you don&rsquo;t. There a time and  a place for both, and in the next post, we&rsquo;ll see how Elixir provides an abstraction for handling these messages with GenServers.</p>

<p>Want to try out your understanding? Clone <a href="https://github.com/octosteve/processes_in_elixir">this repo</a> and get all of the tests passing!</p>

<p>If you get stuck, be sure to checkout the <code>solution</code> branch.</p>

    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'hostiledeveloper'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  </main>

 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48123503-1', 'auto');
  ga('send', 'pageview');

</script>

 <em>Copyright &copy; 2021 Steven Nu&ntilde;ez - HostileDeveloper</em>

</div>
</body>
</html>
