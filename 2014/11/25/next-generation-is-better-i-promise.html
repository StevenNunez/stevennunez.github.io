<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1'/>
  <title>Hostile Developer - Next generation is better. I promise</title>
  <link href="/stylesheets/application.css" media="screen" rel="stylesheet" type="text/css" />
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />

</head>
<body>
<div id="container">
  <section>
    <header>
      <a href="/">
          <h1 class="brand"><span class="hostile">Hostile</span> Developer</h1>

          <h3 class="tag-line">I am Steven. Hear me Rant.</h3>
      </a>
    </header>
  </section>

  <div id="main" role="main">
    
      <h1 class="article-title"><a href="/2014/11/25/next-generation-is-better-i-promise.html">Next generation is better. I promise</a></h1>
    

    <h1>Yey!&hellip;.?</h1>

<p>In addition to my regular hostility towards programming, I occasionally get really excited about stuff. When I heard that <a href="http://blog.chromium.org/2014/10/chrome-39-beta-js-generators-animation.html">Chrome 39</a> had native support for Generators, I got really excited&hellip; until I realized I didn&rsquo;t really know what that meant.</p>

<h2>Everything but the kitchen sync</h2>

<p><a href="git.io/es6features">ES6 Features</a> are sneaking into <a href="http://kangax.github.io/compat-table/es6/">browsers</a> already. A lot of features are around dealing with asynchronous code. Generators are really cool in that they let you pause a functions execution until all <code>yield</code> statements are done. Take a look at this code:</p>
<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="kd">function</span><span class="o">*</span> <span class="nx">rainbow</span><span class="p">(){</span>
  <span class="nx">yield</span> <span class="s2">"Red"</span><span class="p">;</span>
  <span class="nx">yield</span> <span class="s2">"Orange"</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"I'm all done"</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">lameRainbow</span> <span class="o">=</span> <span class="nx">rainbow</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Current Color: "</span> <span class="o">+</span> <span class="nx">lameRainbow</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Current Color: "</span> <span class="o">+</span> <span class="nx">lameRainbow</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Current Color: "</span> <span class="o">+</span> <span class="nx">lameRainbow</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">);</span>
<span class="c1">// ***Prints***  Current Color: Red
// ***Prints***  Current Color: Orange
// ***Prints***  I'm all done
// ***Prints***  Current Color: undefined
</span></pre></td></tr></tbody></table>
</div>

<p>This is pretty nice! But by itself, it&rsquo;s kind of useless. We&rsquo;ll need to learn a bit more about what gets returned when we call <code>next</code>.</p>

<h3>NEXT!</h3>

<p>The value we get from calling <code>next</code> is an object that has 2 properties. The value being yielded, and whether the generator is done:</p>
<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre><span class="kd">function</span><span class="o">*</span> <span class="nx">rainbow</span><span class="p">(){</span>
  <span class="nx">yield</span> <span class="s2">"Red"</span><span class="p">;</span>
  <span class="nx">yield</span> <span class="s2">"Orange"</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"I'm all done"</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">lameRainbow</span> <span class="o">=</span> <span class="nx">rainbow</span><span class="p">();</span>
<span class="nx">lameRainbow</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
<span class="c1">// Object {value: "Red", done: false}
</span><span class="nx">lameRainbow</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
<span class="c1">// Object {value: "Orange", done: false}
</span><span class="nx">lameRainbow</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
<span class="c1">// Object {value: undefined, done: true}
</span></pre></td></tr></tbody></table>
</div>

<p>With this in mind, it&rsquo;s pretty easy to go through all of the generator values in a loop:</p>
<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre></td><td class="code"><pre><span class="kd">function</span><span class="o">*</span> <span class="nx">rainbow</span><span class="p">(){</span>
  <span class="nx">yield</span> <span class="s2">"Red"</span><span class="p">;</span>
  <span class="nx">yield</span> <span class="s2">"Orange"</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"I'm all done"</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">lameRainbow</span> <span class="o">=</span> <span class="nx">rainbow</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">lameRainbow</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
<span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="nx">current</span><span class="p">.</span><span class="nx">done</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Current Color: "</span> <span class="o">+</span> <span class="nx">current</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
  <span class="nx">current</span> <span class="o">=</span> <span class="nx">lameRainbow</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">// ***Prints***  Current Color: Red
// ***Prints***  Current Color: Orange
// ***Prints***  I'm all done
</span></pre></td></tr></tbody></table>
</div>

<h3>It&rsquo;ll be back</h3>

<p>We saw how to pass values out of a function using <code>yield</code>, but we can also pass values back in and use it in our function. Here&rsquo;s an example:</p>
<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre><span class="kd">function</span><span class="o">*</span> <span class="nx">brat</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">gift</span> <span class="o">=</span> <span class="nx">yield</span> <span class="s2">"What are you giving me?"</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">gift</span> <span class="o">===</span> <span class="s2">"diamonds"</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"OMG YOU'RE THE BEST"</span><span class="p">)</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Whatever"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">brat</span><span class="p">();</span>
<span class="nx">a</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span> <span class="c1">// returns "What are you giving me?" in an object
</span><span class="nx">a</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="s2">"diamonds"</span><span class="p">);</span> <span class="c1">// Passes "diamonds" and assigns it to our gift variable.
</span></pre></td></tr></tbody></table>
</div>

<h2>This is going to be awesome: Promise</h2>

<p>Another cool es6 feature is the Promise. This showed up as a way to handle asynchronous requests via the <a href="https://github.com/kriskowal/q">q library</a>. Other libraries have implemented this pattern, including jQuery and AngularJS and now Chrome and Firefox have native support for Promises.</p>

<h3>Promises Promises</h3>

<p>A promise is a way of encapsulating how to handle asynchronous requests. The typical workflow is:</p>

<ol>
<li>Make a request</li>
<li>Create a callback to handle success</li>
<li>Create a callback to handle failure</li>
</ol>

<p>A promise wraps all of these steps together and provides you with one object you can extract the resulting code from. Here&rsquo;s an example of wrapping a call to the reddit api in a promise:</p>
<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20</pre></td><td class="code"><pre><span class="c1">// Assuming you have jQuery :-)
// POINT 1
</span><span class="kd">var</span> <span class="nx">getReddit</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">){</span>
  <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s1">'http://reddit.com/r/science.json?jsonp=?'</span><span class="p">).</span>
  <span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">){</span>
    <span class="c1">// POINT 2
</span>      <span class="nx">resolve</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
  <span class="p">}).</span>
  <span class="nx">error</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="c1">// POINT 3
</span>    <span class="nx">reject</span><span class="p">(</span><span class="nb">Error</span><span class="p">(</span><span class="s2">"Explosion!"</span><span class="p">))})</span>
  <span class="p">});</span>

<span class="c1">// POINT 4
</span><span class="nx">getReddit</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">){</span>
     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
   <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">){</span>
     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
   <span class="p">});</span>
<span class="c1">// Gets you a reddit
</span></pre></td></tr></tbody></table>
</div>

<p>At POINT 1 we&rsquo;re creating a new promise. Promises take a function that expects 2 arguments: a <code>resolve</code> function, and a <code>reject</code> function. Inside the promise, you write your normal callback laden code, dealing with success, and failure cases. With a promise, you&rsquo;re preparing the data, and calling the <code>resolve</code> function when it&rsquo;s done being processed. In our case, we aren&rsquo;t processing the results, so we just pass them into the <code>resolve</code> function at POINT 2. At POINT 3 we deal with errors by passing a new <code>Error</code> to the <code>reject</code> function.</p>

<p>By the time we get to POINT 4, we have a function that has access to the result of the call to Reddit. We can access the success case by tagging on the <code>then</code> function with instructions on what to do with the result. Nice! Errors are available by calling the <code>catch</code> function.</p>

<h2>When your powers combine&hellip;</h2>

<p>Ok, let&rsquo;s cook. Using promises and generators we can make code that is asynchronous but looks synchronous because we encapsulate all of async stuff.  We&rsquo;re going to build out a few functions, and use them to make some bad ass stuff.</p>

<p>We&rsquo;ll be using a call to the reddit api in our example. We&rsquo;ll set up a promise that makes a call the reddit, but only returns the first 3 stories found.</p>
<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">top3FromReddit</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">){</span>
  <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s1">'http://reddit.com/r/science.json?jsonp=?'</span><span class="p">).</span>
  <span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">stories</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
      <span class="nx">resolve</span><span class="p">(</span><span class="nx">stories</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></td></tr></tbody></table>
</div>

<p>In the success callback, we&rsquo;re going through the results from Reddit and only returning an array of 3 stories.</p>

<p>Next, we&rsquo;ll create a generator that yields this promise, and allows the caller to return a new transformed value. We&rsquo;ll finish by printing the result.</p>
<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="kd">function</span><span class="o">*</span> <span class="nx">redditGenerator</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">stories</span> <span class="o">=</span> <span class="nx">yield</span> <span class="nx">top3FromReddit</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">stories</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>

<p>Any callers of this generator will be yielded the promise we created earlier. In a bit, we&rsquo;re going to use this generator to return story titles, but first we&rsquo;ll need a small helper function.</p>

<p>This was inspired by the example <a href="https://www.promisejs.org/generators/">here</a>.</p>
<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="kd">function</span> <span class="nx">async</span><span class="p">(</span><span class="nx">generatorFunction</span><span class="p">,</span> <span class="nx">callback</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">generator</span> <span class="o">=</span> <span class="nx">generatorFunction</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">generator</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">;</span>
  <span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">){</span>
    <span class="nx">generator</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">callback</span><span class="p">(</span><span class="nx">result</span><span class="p">));</span>
  <span class="p">})</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>

<p>Our <code>async</code> function takes a generator function and a callback.
We create a generator from the function, call <code>next</code> and <code>value</code> to get the promise yielded. We call the <code>then</code> function on our promise and pass the return value of our callback function BACK to the generator. This value will be set to <code>stories</code> inside the redditGenerator.</p>

<p>This is an insanely limted example. Checkout the link above for a better solution, but this one works for us.</p>

<p>And finally, make our call to reddit, wrapping the call in our <code>async</code> function.</p>
<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="nx">async</span><span class="p">(</span><span class="nx">redditGenerator</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">){</span>
  <span class="k">return</span> <span class="nx">result</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">story</span><span class="p">){</span>
    <span class="k">return</span> <span class="nx">story</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">title</span>
  <span class="p">})</span>
<span class="p">})</span>
</pre></td></tr></tbody></table>
</div>

<h1>Recap</h1>

<p>Generators are a really cool tool that lets you pause execution of javascript code, and coupled with promises can allow for the creation of expressive asynchronous code that appears synchronous.</p>

<p>Happy Clacking.</p>

    
      <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'hostiledeveloper'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    
  </div>

  <aside>
    <section class="recent">
      <h2>Recent Articles</h2>
      <ol class="articles">
        
            <li><a href="/2014/11/25/next-generation-is-better-i-promise.html">Next generation is better. I promise</a>
        
            <li><a href="/2014/05/18/using-ruby-to-learn-javascript.html">Using Ruby to learn JavaScript</a>
        
            <li><a href="/2014/04/26/on-why-learning-to-program-is-hard.html">On why learning to program is hard</a>
        
            <li><a href="/2014/04/13/closures.html">Closures</a>
        
            <li><a href="/2014/02/15/custom-params-in-route-resources.html">Custom params in route resources</a>
        
            <li><a href="/2013/10/19/keyboard-navigation.html">Keyboard Navigation</a>
        
      </ol>
    </section>

    <section class="tags">
      <h2>Tags</h2>
      <ol>
        
            <li><a href="/tags/beginner.html">beginner</a> (1)</a></li>
        
            <li><a href="/tags/closures.html">closures</a> (1)</a></li>
        
            <li><a href="/tags/components-of-programming.html">components of programming</a> (1)</a></li>
        
            <li><a href="/tags/generators.html">generators</a> (1)</a></li>
        
            <li><a href="/tags/javascript.html">javascript</a> (3)</a></li>
        
            <li><a href="/tags/learning.html">learning</a> (1)</a></li>
        
            <li><a href="/tags/navigation.html">navigation</a> (1)</a></li>
        
            <li><a href="/tags/polyglot.html">polyglot</a> (1)</a></li>
        
            <li><a href="/tags/promises.html">promises</a> (1)</a></li>
        
            <li><a href="/tags/rails.html">rails</a> (1)</a></li>
        
            <li><a href="/tags/routing.html">routing</a> (1)</a></li>
        
            <li><a href="/tags/ruby.html">ruby</a> (3)</a></li>
        
            <li><a href="/tags/sharp-axe.html">sharp axe</a> (1)</a></li>
        
            <li><a href="/tags/web.html">web</a> (1)</a></li>
        
      </ol>
    </section>

    <section class="by-month">
      <h2>By Month</h2>
      <ol>
        
            <li><a href="/2014/11.html">November 2014</a>
              (1)</a></li>
        
            <li><a href="/2014/05.html">May 2014</a>
              (1)</a></li>
        
            <li><a href="/2014/04.html">April 2014</a>
              (2)</a></li>
        
            <li><a href="/2014/02.html">February 2014</a>
              (1)</a></li>
        
            <li><a href="/2013/10.html">October 2013</a>
              (1)</a></li>
        
      </ol>
    </section>
  </aside>
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48123503-1', 'auto');
  ga('send', 'pageview');

</script>

</div>
</body>
</html>
